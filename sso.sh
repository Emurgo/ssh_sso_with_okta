#!/bin/bash
if [ ! -d "/lib/security" ];then
	mkdir /lib/security
fi
if [ ! -d "/root/deviceflow" ];then
	mkdir /root/deviceflow
fi
cd /root/deviceflow
wget https://raw.githubusercontent.com/oktadev/okta-ssh-oauth-example/master/qr.c
apt-get update && apt install lsb-release net-tools vim openssh-server git build-essential libpam0g-dev libcurl4-openssl-dev  libqrencode-dev libssl-dev -y
echo LyoqKioqKioqKioqKioqCkxpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCmRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uCnJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQoiTGljZW5zZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCndpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLApzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbgoiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCnNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMKdW5kZXIgdGhlIExpY2Vuc2UuCioqKioqKioqKiovCgovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogKiBhdXRob3I6ICAgICAgSHVhbiBMaXUKICogZGVzY3JpcHRpb246IFBBTSBtb2R1bGUgdG8gdXNlIGRldmljZSBmbG93CioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiNpbmNsdWRlIDxzdGRpby5oPgojaW5jbHVkZSA8c3RkbGliLmg+CiNpbmNsdWRlIDxzdHJpbmcuaD4KI2luY2x1ZGUgPHVuaXN0ZC5oPgoKI2luY2x1ZGUgPGN1cmwvY3VybC5oPgojaW5jbHVkZSA8c2VjdXJpdHkvcGFtX2FwcGwuaD4KI2luY2x1ZGUgPHNlY3VyaXR5L3BhbV9tb2R1bGVzLmg+CiNpbmNsdWRlIDxzZWN1cml0eS9wYW1fZXh0Lmg+CgovKiBuZWVkZWQgZm9yIGJhc2U2NCBkZWNvZGVyICovCiNpbmNsdWRlIDxvcGVuc3NsL3BlbS5oPgoKI2RlZmluZSBERVZJQ0VfQVVUSE9SSVpFX1VSTCAgImh0dHBzOi8vZW11cmdvLm9rdGEuY29tL29hdXRoMi92MS9kZXZpY2UvYXV0aG9yaXplIgojZGVmaW5lIFRPS0VOX1VSTCAiaHR0cHM6Ly9lbXVyZ28ub2t0YS5jb20vb2F1dGgyL3YxL3Rva2VuIgojZGVmaW5lIENMSUVOVF9JRCAiMG9hNGd1MzJ3alE1WjFDTkI2OTciCgovKiBzdHJ1Y3R1cmUgdXNlZCBmb3IgY3VybCByZXR1cm4gKi8Kc3RydWN0IE1lbW9yeVN0cnVjdCB7CiAgY2hhciAqbWVtb3J5OwogIHNpemVfdCBzaXplOwp9OwoKY2hhciAqYmFzZTY0ZGVjb2RlIChjb25zdCB2b2lkICpiNjRfZGVjb2RlX3RoaXMsIGludCBkZWNvZGVfdGhpc19tYW55X2J5dGVzKXsKICAgIEJJTyAqYjY0X2JpbywgKm1lbV9iaW87ICAgICAgLy9EZWNsYXJlcyB0d28gT3BlblNTTCBCSU9zOiBhIGJhc2U2NCBmaWx0ZXIgYW5kIGEgbWVtb3J5IEJJTy4KICAgIGNoYXIgKmJhc2U2NF9kZWNvZGVkID0gY2FsbG9jKCAoZGVjb2RlX3RoaXNfbWFueV9ieXRlcyozKS80KzEsIHNpemVvZihjaGFyKSApOyAvLysxID0gbnVsbC4KICAgIGI2NF9iaW8gPSBCSU9fbmV3KEJJT19mX2Jhc2U2NCgpKTsgICAgICAgICAgICAgICAgICAgICAgLy9Jbml0aWFsaXplIG91ciBiYXNlNjQgZmlsdGVyIEJJTy4KICAgIG1lbV9iaW8gPSBCSU9fbmV3KEJJT19zX21lbSgpKTsgICAgICAgICAgICAgICAgICAgICAgICAgLy9Jbml0aWFsaXplIG91ciBtZW1vcnkgc291cmNlIEJJTy4KICAgIEJJT193cml0ZShtZW1fYmlvLCBiNjRfZGVjb2RlX3RoaXMsIGRlY29kZV90aGlzX21hbnlfYnl0ZXMpOyAvL0Jhc2U2NCBkYXRhIHNhdmVkIGluIHNvdXJjZS4KICAgIEJJT19wdXNoKGI2NF9iaW8sIG1lbV9iaW8pOyAgICAgICAgICAvL0xpbmsgdGhlIEJJT3MgYnkgY3JlYXRpbmcgYSBmaWx0ZXItc291cmNlIEJJTyBjaGFpbi4KICAgIEJJT19zZXRfZmxhZ3MoYjY0X2JpbywgQklPX0ZMQUdTX0JBU0U2NF9OT19OTCk7ICAgICAgICAgIC8vRG9uJ3QgcmVxdWlyZSB0cmFpbGluZyBuZXdsaW5lcy4KICAgIGludCBkZWNvZGVkX2J5dGVfaW5kZXggPSAwOyAgIC8vSW5kZXggd2hlcmUgdGhlIG5leHQgYmFzZTY0X2RlY29kZWQgYnl0ZSBzaG91bGQgYmUgd3JpdHRlbi4KICAgIHdoaWxlICggMCA8IEJJT19yZWFkKGI2NF9iaW8sIGJhc2U2NF9kZWNvZGVkK2RlY29kZWRfYnl0ZV9pbmRleCwgMSkgKXsgLy9SZWFkIGJ5dGUtYnktYnl0ZS4KICAgICAgICBkZWNvZGVkX2J5dGVfaW5kZXgrKzsgLy9JbmNyZW1lbnQgdGhlIGluZGV4IHVudGlsIHJlYWQgb2YgQklPIGRlY29kZWQgZGF0YSBpcyBjb21wbGV0ZS4KICAgIH0gLy9PbmNlIHdlJ3JlIGRvbmUgcmVhZGluZyBkZWNvZGVkIGRhdGEsIEJJT19yZWFkIHJldHVybnMgLTEgZXZlbiB0aG91Z2ggdGhlcmUncyBubyBlcnJvci4KICAgIEJJT19mcmVlX2FsbChiNjRfYmlvKTsgIC8vRGVzdHJveXMgYWxsIEJJT3MgaW4gY2hhaW4sIHN0YXJ0aW5nIHdpdGggYjY0IChpLmUuIHRoZSAxc3Qgb25lKS4KICAgIHJldHVybiBiYXNlNjRfZGVjb2RlZDsgICAgICAgIC8vUmV0dXJucyBiYXNlLTY0IGRlY29kZWQgZGF0YSB3aXRoIHRyYWlsaW5nIG51bGwgdGVybWluYXRvci4KfQoKLyogZnVuY3Rpb24gdG8gd3JpdGUgY3VybCBvdXRwdXQgKi8Kc3RhdGljIHNpemVfdApXcml0ZU1lbW9yeUNhbGxiYWNrKHZvaWQgKmNvbnRlbnRzLCBzaXplX3Qgc2l6ZSwgc2l6ZV90IG5tZW1iLCB2b2lkICp1c2VycCkKewogIHNpemVfdCByZWFsc2l6ZSA9IHNpemUgKiBubWVtYjsKICBzdHJ1Y3QgTWVtb3J5U3RydWN0ICptZW0gPSAoc3RydWN0IE1lbW9yeVN0cnVjdCAqKXVzZXJwOwoKICBjaGFyICpwdHIgPSByZWFsbG9jKG1lbS0+bWVtb3J5LCBtZW0tPnNpemUgKyByZWFsc2l6ZSArIDEpOwogIGlmKCFwdHIpIHsKICAgIC8qIG91dCBvZiBtZW1vcnkhICovCiAgICBwcmludGYoIm5vdCBlbm91Z2ggbWVtb3J5IChyZWFsbG9jIHJldHVybmVkIE5VTEwpXG4iKTsKICAgIHJldHVybiAwOwogIH0KCiAgbWVtLT5tZW1vcnkgPSBwdHI7CiAgbWVtY3B5KCYobWVtLT5tZW1vcnlbbWVtLT5zaXplXSksIGNvbnRlbnRzLCByZWFsc2l6ZSk7CiAgbWVtLT5zaXplICs9IHJlYWxzaXplOwogIG1lbS0+bWVtb3J5W21lbS0+c2l6ZV0gPSAwOwoKICByZXR1cm4gcmVhbHNpemU7Cn0KCi8qIHBhcnNlIEpTT04gb3V0cHV0IGxvb2tpbmcgZm9yIHZhbHVlIGZvciBhIGtleS4gQXNzdW1lIHN0cmluZyBrZXkgdmFsdWUsIHNvIGl0IHBhcnNlcyBvbiBcIiBib3VuZGFyeSAqLwpjaGFyICogZ2V0VmFsdWVGb3JLZXkoY2hhciAqIGluLCBjb25zdCBjaGFyICoga2V5KSB7CgljaGFyICogdG9rZW4gPSBzdHJ0b2soaW4sICJcIiIpOwogICAgICAgIHdoaWxlICggdG9rZW4gIT0gTlVMTCApIHsKICAgICAgICAJaWYgKCFzdHJjbXAodG9rZW4sIGtleSkpIHsKICAgICAgICAgICAgICAgIAl0b2tlbiA9IHN0cnRvayhOVUxMLCAiXCIiKTsgLyogc2tpcCA6ICovCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gc3RydG9rKE5VTEwsICJcIiIpOwoJCQlyZXR1cm4gdG9rZW47CgkJfQoJCXRva2VuID0gc3RydG9rKE5VTEwsICJcIiIpOwoJfQoJcmV0dXJuIE5VTEw7Cn0KCkNVUkwgKmN1cmw7CnN0cnVjdCBNZW1vcnlTdHJ1Y3QgY2h1bms7Cgp2b2lkIGlzc3VlUG9zdChjaGFyICogdXJsLCBjaGFyICogZGF0YSkgewogICAgICAgIC8qIHNlbmQgYWxsIGRhdGEgdG8gdGhpcyBmdW5jdGlvbiAgKi8KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfV1JJVEVGVU5DVElPTiwgV3JpdGVNZW1vcnlDYWxsYmFjayk7CiAgICAgICAgLyogd2UgcGFzcyBvdXIgJ2NodW5rJyBzdHJ1Y3QgdG8gdGhlIGNhbGxiYWNrIGZ1bmN0aW9uICovCiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1dSSVRFREFUQSwgKHZvaWQgKikmY2h1bmspOwoKICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfVVJMLCB1cmwgKSA7CiAgICAgICAgY3VybF9lYXN5X3NldG9wdChjdXJsLCBDVVJMT1BUX1BPU1QsIDEpOyAgLyogdGhpcyBpcyBhIFBPU1QgKi8KICAgICAgICBjdXJsX2Vhc3lfc2V0b3B0KGN1cmwsIENVUkxPUFRfUE9TVEZJRUxEUywgZGF0YSk7CiAgICAgICAgaW50IHJlcyA9IGN1cmxfZWFzeV9wZXJmb3JtKCBjdXJsICkgOwp9CgoKdm9pZApzZW5kUEFNTWVzc2FnZShwYW1faGFuZGxlX3QgKnBhbWgsIGNoYXIgKiBwcm9tcHRfbWVzc2FnZSkgewogICAgICAgIGludCByZXR2YWw7CgkvL2NoYXIgKiByZXNwOwogICAgICAgIAovLwlyZXR2YWwgPSBwYW1fcHJvbXB0KHBhbWgsIFBBTV9URVhUX0lORk8sICZyZXNwLCAiJXMiLCBwcm9tcHRfbWVzc2FnZSk7CiAgICAgIAoJc3RydWN0IHBhbV9tZXNzYWdlIG1zZ1sxXSwqcG1zZ1sxXTsKICAgICAgICBzdHJ1Y3QgcGFtX3Jlc3BvbnNlICpyZXNwOwogICAgICAgIHN0cnVjdCBwYW1fY29udiAqY29udiA7CgogICAgICAgIHBtc2dbMF0gPSAmbXNnWzBdIDsKICAgICAgICBtc2dbMF0ubXNnX3N0eWxlID0gUEFNX1RFWFRfSU5GTyA7CiAgICAgICAgbXNnWzBdLm1zZyA9IHByb21wdF9tZXNzYWdlOwoKICAgICAgICByZXNwID0gTlVMTCA7CgogICAgICAgIHJldHZhbCA9IHBhbV9nZXRfaXRlbSggcGFtaCwgUEFNX0NPTlYsIChjb25zdCB2b2lkICoqKSAmY29udiApIDsKICAgICAgICBpZiggcmV0dmFsPT1QQU1fU1VDQ0VTUyApIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IGNvbnYtPmNvbnYoIDEsIChjb25zdCBzdHJ1Y3QgcGFtX21lc3NhZ2UgKiopIHBtc2csICZyZXNwLCBjb252LT5hcHBkYXRhX3B0ciApIDsKICAgICAgICB9CiAgICAgICAgaWYoIHJlc3AgKSB7CiAgICAgICAgICAgICAgICBmcmVlKCByZXNwICk7CiAgICAgICAgfQp9CgoKCmV4dGVybiBjaGFyICogZ2V0UVIoY2hhciAqIHN0cik7CgovKiBleHBlY3RlZCBob29rICovClBBTV9FWFRFUk4gaW50IHBhbV9zbV9zZXRjcmVkKCBwYW1faGFuZGxlX3QgKnBhbWgsIGludCBmbGFncywgaW50IGFyZ2MsIGNvbnN0IGNoYXIgKiphcmd2ICkgewogICAgICAgIHJldHVybiBQQU1fU1VDQ0VTUyA7Cn0KCi8qIGV4cGVjdGVkIGhvb2ssIHRoaXMgaXMgd2hlcmUgY3VzdG9tIHN0dWZmIGhhcHBlbnMgKi8KUEFNX0VYVEVSTiBpbnQgcGFtX3NtX2F1dGhlbnRpY2F0ZSggcGFtX2hhbmRsZV90ICpwYW1oLCBpbnQgZmxhZ3MsaW50IGFyZ2MsIGNvbnN0IGNoYXIgKiphcmd2ICkgewogICAgICAgIGludCByZXMgOwoJY2hhciBwb3N0RGF0YVsxMDI0XTsKCiAgICAgICAgZnByaW50ZihzdGRlcnIsICJzdGFydGluZ1xuIik7CgogICAgICAgIC8qIG1lbW9yeSBmb3IgY3VybCByZXR1cm4gKi8KICAgICAgICBjaHVuay5tZW1vcnkgPSBtYWxsb2MoMSk7ICAvKiB3aWxsIGJlIGdyb3duIGFzIG5lZWRlZCBieSB0aGUgcmVhbGxvYyBhYm92ZSAqLwogICAgICAgIGNodW5rLnNpemUgPSAwOyAgICAvKiBubyBkYXRhIGF0IHRoaXMgcG9pbnQgKi8KCiAgICAgICAgLyogaW5pdCBDdXJsIGhhbmRsZSAqLwogICAgICAgIGN1cmxfZ2xvYmFsX2luaXQoQ1VSTF9HTE9CQUxfQUxMKTsKICAgICAgICBjdXJsID0gY3VybF9lYXN5X2luaXQoKTsKCiAgICAgICAgLyogaG9sZCB0ZW1wIHN0cmluZyAqLwogICAgICAgIGNoYXIgc3RyMVs0MDk2XSwgc3RyMlsxMDI0XSwgc3RyM1sxMDI0XTs7CgogICAgICAgIC8qIGNhbGwgYXV0aG9yaXplIGVuZCBwb2ludCAqLwoJc3ByaW50Zihwb3N0RGF0YSwgImNsaWVudF9pZD0lcyZzY29wZT1vcGVuaWQgcHJvZmlsZSBvZmZsaW5lX2FjY2VzcyIsIENMSUVOVF9JRCk7IAogICAgICAgIGlzc3VlUG9zdChERVZJQ0VfQVVUSE9SSVpFX1VSTCwgcG9zdERhdGEpOwoKCXN0cmNweShzdHIxLCBjaHVuay5tZW1vcnkpOwogICAgICAgIGNoYXIgKiB1c2VyY29kZSA9IGdldFZhbHVlRm9yS2V5KHN0cjEsICJ1c2VyX2NvZGUiKTsKCXN0cmNweShzdHIyLCBjaHVuay5tZW1vcnkpOwogICAgICAgIGNoYXIgKiBkZXZpY2Vjb2RlID0gZ2V0VmFsdWVGb3JLZXkoc3RyMiwgImRldmljZV9jb2RlIik7CglzdHJjcHkoc3RyMywgY2h1bmsubWVtb3J5KTsKCWNoYXIgKiBhY3RpdmF0ZVVybCA9IGdldFZhbHVlRm9yS2V5KHN0cjMsICJ2ZXJpZmljYXRpb25fdXJpIik7CiAgICAgICAgcHJpbnRmKCJhdXRoOiAlcyAlc1xuIiwgdXNlcmNvZGUsIGRldmljZWNvZGUpOwoKCWNoYXIgcHJvbXB0X21lc3NhZ2VbMjAwMF07CiAgICAgICAgY2hhciAqIHFyYyA9IGdldFFSKGFjdGl2YXRlVXJsKTsKICAJc3ByaW50Zihwcm9tcHRfbWVzc2FnZSwgIlxuXG5QbGVhc2UgbG9naW4gYXQgJXMgb3Igc2NhbiB0aGUgUVJDb2RlIGJlbG93OlxuVGhlbiBpbnB1dCBjb2RlICVzXG5cbiVzIiwgYWN0aXZhdGVVcmwsIHVzZXJjb2RlLCBxcmMgKTsKICAgICAgICBmcmVlKHFyYyk7CiAgICAgICAgc2VuZFBBTU1lc3NhZ2UocGFtaCwgcHJvbXB0X21lc3NhZ2UpOwoKCS8qIHdvcmsgYXJvdW5kIFNTSCBQQU0gYnVnIHRoYXQgYnVmZmVycyBQQU1fVEVYVF9JTkZPICovIAoJY2hhciAqIHJlc3A7CiAgICAgICAgcmVzID0gcGFtX3Byb21wdChwYW1oLCBQQU1fUFJPTVBUX0VDSE9fT04sICZyZXNwLCAiUHJlc3MgRW50ZXIgdG8gY29udGludWU6Iik7CgogICAgICAgIGludCB3YWl0aW5nRm9yQWN0aXZhdGUgPSAxOwogICAgICAgIHNwcmludGYocG9zdERhdGEsICJkZXZpY2VfY29kZT0lcyZncmFudF90eXBlPXVybjppZXRmOnBhcmFtczpvYXV0aDpncmFudC10eXBlOmRldmljZV9jb2RlJmNsaWVudF9pZD0lcyIsIGRldmljZWNvZGUsIENMSUVOVF9JRCk7CgogICAgICAgIHdoaWxlICh3YWl0aW5nRm9yQWN0aXZhdGUpIHsKICAgICAgICAgICAgICAgIC8vIHNlbmRQQU1NZXNzYWdlKHBhbWgsICJXYWl0aW5nIGZvciB1c2VyIGFjdGl2YXRpb24iKTsKCiAgICAgICAgICAgICAgICBjaHVuay5zaXplID0gMDsKICAgICAgICAgICAgICAgIGlzc3VlUG9zdChUT0tFTl9VUkwsIHBvc3REYXRhKTsKCgkJc3RyY3B5KHN0cjEsIGNodW5rLm1lbW9yeSk7CiAgICAgICAgICAgICAgICBjaGFyICogZXJyb3Jtc2cgPSBnZXRWYWx1ZUZvcktleShzdHIxLCAiZXJyb3IiKTsKICAgICAgICAgICAgICAgIGlmIChlcnJvcm1zZyA9PSBOVUxMKSB7CgoJCQkvKiBQYXJzZSByZXNwb25zZSB0byBmaW5kIGlkX3Rva2VuLCB0aGVuIGZpbmQgcGF5bG9hZCwgdGhlbiBmaW5kIG5hbWUgY2xhaW0gKi8KCQkJY2hhciAqIGlkdG9rZW4gPSBnZXRWYWx1ZUZvcktleShjaHVuay5tZW1vcnksICJpZF90b2tlbiIpOwoKCQkJY2hhciAqIGhlYWRlciA9IHN0cnRvayhpZHRva2VuLCAiLiIpOwoJCQljaGFyICogcGF5bG9hZCA9IHN0cnRvayhOVUxMLCAiLiIpOwoKCQkJY2hhciAqIGRlY29kZWQgPSBiYXNlNjRkZWNvZGUocGF5bG9hZCwgc3RybGVuKHBheWxvYWQpKTsKCgkJCWNoYXIgKiBuYW1lID0gZ2V0VmFsdWVGb3JLZXkoZGVjb2RlZCwgIm5hbWUiKTsKCgkJCXNwcmludGYocHJvbXB0X21lc3NhZ2UsICJcblxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gIFdlbGNvbWUsICVzXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcblxuXG4iLCBuYW1lKTsKCQkJc2VuZFBBTU1lc3NhZ2UocGFtaCwgcHJvbXB0X21lc3NhZ2UpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cmwpIGN1cmxfZWFzeV9jbGVhbnVwKCBjdXJsICkgOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJsX2dsb2JhbF9jbGVhbnVwKCk7CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUEFNX1NVQ0NFU1M7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwcmludGYoImVycm9yICVzXG4iLCBlcnJvcm1zZyk7CiAgICAgICAgICAgICAgICBzbGVlcCg1KTsKICAgICAgICB9CiAgICAgICAgLyogQ3VybCBjbGVhbiB1cCAqLwogICAgICAgIGlmIChjdXJsKSBjdXJsX2Vhc3lfY2xlYW51cCggY3VybCApIDsKICAgICAgICBjdXJsX2dsb2JhbF9jbGVhbnVwKCk7CgogICAgICAgIHJldHVybiBQQU1fQVVUSF9FUlI7Cn0= | base64 -d > deviceflow.c
echo IyBUaGlzIGlzIHRoZSBzc2hkIHNlcnZlciBzeXN0ZW0td2lkZSBjb25maWd1cmF0aW9uIGZpbGUuICBTZWUKIyBzc2hkX2NvbmZpZyg1KSBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KCiMgVGhpcyBzc2hkIHdhcyBjb21waWxlZCB3aXRoIFBBVEg9L3Vzci9sb2NhbC9zYmluOi91c3IvbG9jYWwvYmluOi91c3Ivc2JpbjovdXNyL2Jpbjovc2JpbjovYmluOi91c3IvZ2FtZXMKCiMgVGhlIHN0cmF0ZWd5IHVzZWQgZm9yIG9wdGlvbnMgaW4gdGhlIGRlZmF1bHQgc3NoZF9jb25maWcgc2hpcHBlZCB3aXRoCiMgT3BlblNTSCBpcyB0byBzcGVjaWZ5IG9wdGlvbnMgd2l0aCB0aGVpciBkZWZhdWx0IHZhbHVlIHdoZXJlCiMgcG9zc2libGUsIGJ1dCBsZWF2ZSB0aGVtIGNvbW1lbnRlZC4gIFVuY29tbWVudGVkIG9wdGlvbnMgb3ZlcnJpZGUgdGhlCiMgZGVmYXVsdCB2YWx1ZS4KCkluY2x1ZGUgL2V0Yy9zc2gvc3NoZF9jb25maWcuZC8qLmNvbmYKCiNQb3J0IDIyCiNBZGRyZXNzRmFtaWx5IGFueQojTGlzdGVuQWRkcmVzcyAwLjAuMC4wCiNMaXN0ZW5BZGRyZXNzIDo6CgojSG9zdEtleSAvZXRjL3NzaC9zc2hfaG9zdF9yc2Ffa2V5CiNIb3N0S2V5IC9ldGMvc3NoL3NzaF9ob3N0X2VjZHNhX2tleQojSG9zdEtleSAvZXRjL3NzaC9zc2hfaG9zdF9lZDI1NTE5X2tleQoKIyBDaXBoZXJzIGFuZCBrZXlpbmcKI1Jla2V5TGltaXQgZGVmYXVsdCBub25lCgojIExvZ2dpbmcKI1N5c2xvZ0ZhY2lsaXR5IEFVVEgKI0xvZ0xldmVsIElORk8KCiMgQXV0aGVudGljYXRpb246CgojTG9naW5HcmFjZVRpbWUgMm0KUGVybWl0Um9vdExvZ2luIG5vCiNTdHJpY3RNb2RlcyB5ZXMKI01heEF1dGhUcmllcyA2CiNNYXhTZXNzaW9ucyAxMAoKI1B1YmtleUF1dGhlbnRpY2F0aW9uIHllcwoKIyBFeHBlY3QgLnNzaC9hdXRob3JpemVkX2tleXMyIHRvIGJlIGRpc3JlZ2FyZGVkIGJ5IGRlZmF1bHQgaW4gZnV0dXJlLgojQXV0aG9yaXplZEtleXNGaWxlICAgICAuc3NoL2F1dGhvcml6ZWRfa2V5cyAuc3NoL2F1dGhvcml6ZWRfa2V5czIKCiNBdXRob3JpemVkUHJpbmNpcGFsc0ZpbGUgbm9uZQoKI0F1dGhvcml6ZWRLZXlzQ29tbWFuZCBub25lCiNBdXRob3JpemVkS2V5c0NvbW1hbmRVc2VyIG5vYm9keQoKIyBGb3IgdGhpcyB0byB3b3JrIHlvdSB3aWxsIGFsc28gbmVlZCBob3N0IGtleXMgaW4gL2V0Yy9zc2gvc3NoX2tub3duX2hvc3RzCiNIb3N0YmFzZWRBdXRoZW50aWNhdGlvbiBubwojIENoYW5nZSB0byB5ZXMgaWYgeW91IGRvbid0IHRydXN0IH4vLnNzaC9rbm93bl9ob3N0cyBmb3IKIyBIb3N0YmFzZWRBdXRoZW50aWNhdGlvbgojSWdub3JlVXNlcktub3duSG9zdHMgbm8KIyBEb24ndCByZWFkIHRoZSB1c2VyJ3Mgfi8ucmhvc3RzIGFuZCB+Ly5zaG9zdHMgZmlsZXMKI0lnbm9yZVJob3N0cyB5ZXMKCiMgVG8gZGlzYWJsZSB0dW5uZWxlZCBjbGVhciB0ZXh0IHBhc3N3b3JkcywgY2hhbmdlIHRvIG5vIGhlcmUhCiNQYXNzd29yZEF1dGhlbnRpY2F0aW9uIHllcwojUGVybWl0RW1wdHlQYXNzd29yZHMgbm8KCiMgQ2hhbmdlIHRvIHllcyB0byBlbmFibGUgY2hhbGxlbmdlLXJlc3BvbnNlIHBhc3N3b3JkcyAoYmV3YXJlIGlzc3VlcyB3aXRoCiMgc29tZSBQQU0gbW9kdWxlcyBhbmQgdGhyZWFkcykKCiMgS2VyYmVyb3Mgb3B0aW9ucwojS2VyYmVyb3NBdXRoZW50aWNhdGlvbiBubwojS2VyYmVyb3NPckxvY2FsUGFzc3dkIHllcwojS2VyYmVyb3NUaWNrZXRDbGVhbnVwIHllcwojS2VyYmVyb3NHZXRBRlNUb2tlbiBubwoKIyBHU1NBUEkgb3B0aW9ucwojR1NTQVBJQXV0aGVudGljYXRpb24gbm8KI0dTU0FQSUNsZWFudXBDcmVkZW50aWFscyB5ZXMKI0dTU0FQSVN0cmljdEFjY2VwdG9yQ2hlY2sgeWVzCiNHU1NBUElLZXlFeGNoYW5nZSBubwoKIyBTZXQgdGhpcyB0byAneWVzJyB0byBlbmFibGUgUEFNIGF1dGhlbnRpY2F0aW9uLCBhY2NvdW50IHByb2Nlc3NpbmcsCiMgYW5kIHNlc3Npb24gcHJvY2Vzc2luZy4gSWYgdGhpcyBpcyBlbmFibGVkLCBQQU0gYXV0aGVudGljYXRpb24gd2lsbAojIGJlIGFsbG93ZWQgdGhyb3VnaCB0aGUgS2JkSW50ZXJhY3RpdmVBdXRoZW50aWNhdGlvbiBhbmQKIyBQYXNzd29yZEF1dGhlbnRpY2F0aW9uLiAgRGVwZW5kaW5nIG9uIHlvdXIgUEFNIGNvbmZpZ3VyYXRpb24sCiMgUEFNIGF1dGhlbnRpY2F0aW9uIHZpYSBLYmRJbnRlcmFjdGl2ZUF1dGhlbnRpY2F0aW9uIG1heSBieXBhc3MKIyB0aGUgc2V0dGluZyBvZiAiUGVybWl0Um9vdExvZ2luIHdpdGhvdXQtcGFzc3dvcmQiLgojIElmIHlvdSBqdXN0IHdhbnQgdGhlIFBBTSBhY2NvdW50IGFuZCBzZXNzaW9uIGNoZWNrcyB0byBydW4gd2l0aG91dAojIFBBTSBhdXRoZW50aWNhdGlvbiwgdGhlbiBlbmFibGUgdGhpcyBidXQgc2V0IFBhc3N3b3JkQXV0aGVudGljYXRpb24KIyBhbmQgS2JkSW50ZXJhY3RpdmVBdXRoZW50aWNhdGlvbiB0byAnbm8nLgpVc2VQQU0geWVzCgojQWxsb3dBZ2VudEZvcndhcmRpbmcgeWVzCiNBbGxvd1RjcEZvcndhcmRpbmcgeWVzCiNHYXRld2F5UG9ydHMgbm8KWDExRm9yd2FyZGluZyB5ZXMKI1gxMURpc3BsYXlPZmZzZXQgMTAKI1gxMVVzZUxvY2FsaG9zdCB5ZXMKI1Blcm1pdFRUWSB5ZXMKUHJpbnRNb3RkIG5vCiNQcmludExhc3RMb2cgeWVzCiNUQ1BLZWVwQWxpdmUgeWVzCiNQZXJtaXRVc2VyRW52aXJvbm1lbnQgbm8KI0NvbXByZXNzaW9uIGRlbGF5ZWQKI0NsaWVudEFsaXZlSW50ZXJ2YWwgMAojQ2xpZW50QWxpdmVDb3VudE1heCAzCiNVc2VETlMgbm8KI1BpZEZpbGUgL3J1bi9zc2hkLnBpZAojTWF4U3RhcnR1cHMgMTA6MzA6MTAwCiNQZXJtaXRUdW5uZWwgbm8KI0Nocm9vdERpcmVjdG9yeSBub25lCiNWZXJzaW9uQWRkZW5kdW0gbm9uZQoKIyBubyBkZWZhdWx0IGJhbm5lciBwYXRoCiNCYW5uZXIgbm9uZQoKIyBBbGxvdyBjbGllbnQgdG8gcGFzcyBsb2NhbGUgZW52aXJvbm1lbnQgdmFyaWFibGVzCkFjY2VwdEVudiBMQU5HIExDXyoKCiMgb3ZlcnJpZGUgZGVmYXVsdCBvZiBubyBzdWJzeXN0ZW1zClN1YnN5c3RlbSAgICAgICBzZnRwICAgIC91c3IvbGliL29wZW5zc2gvc2Z0cC1zZXJ2ZXIKCiMgRXhhbXBsZSBvZiBvdmVycmlkaW5nIHNldHRpbmdzIG9uIGEgcGVyLXVzZXIgYmFzaXMKI01hdGNoIFVzZXIgYW5vbmN2cwojICAgICAgIFgxMUZvcndhcmRpbmcgbm8KIyAgICAgICBBbGxvd1RjcEZvcndhcmRpbmcgbm8KIyAgICAgICBQZXJtaXRUVFkgbm8KIyAgICAgICBGb3JjZUNvbW1hbmQgY3ZzIHNlcnZlcgpDaGFsbGVuZ2VSZXNwb25zZUF1dGhlbnRpY2F0aW9uIHllcwpLYmRJbnRlcmFjdGl2ZUF1dGhlbnRpY2F0aW9uIHllcwo= | base64 -d > /etc/ssh/sshd_config
echo IyBQQU0gY29uZmlndXJhdGlvbiBmb3IgdGhlIFNlY3VyZSBTaGVsbCBzZXJ2aWNlCgojIFN0YW5kYXJkIFVuKnggYXV0aGVudGljYXRpb24uCiNAaW5jbHVkZSBjb21tb24tYXV0aAoKYXV0aCByZXF1aXJlZCBkZXZpY2VmbG93LnNvCiMgRGlzYWxsb3cgbm9uLXJvb3QgbG9naW5zIHdoZW4gL2V0Yy9ub2xvZ2luIGV4aXN0cy4KYWNjb3VudCAgICByZXF1aXJlZCAgICAgcGFtX25vbG9naW4uc28KCiMgVW5jb21tZW50IGFuZCBlZGl0IC9ldGMvc2VjdXJpdHkvYWNjZXNzLmNvbmYgaWYgeW91IG5lZWQgdG8gc2V0IGNvbXBsZXgKIyBhY2Nlc3MgbGltaXRzIHRoYXQgYXJlIGhhcmQgdG8gZXhwcmVzcyBpbiBzc2hkX2NvbmZpZy4KIyBhY2NvdW50ICByZXF1aXJlZCAgICAgcGFtX2FjY2Vzcy5zbwoKIyBTdGFuZGFyZCBVbip4IGF1dGhvcml6YXRpb24uCkBpbmNsdWRlIGNvbW1vbi1hY2NvdW50CgojIFNFTGludXggbmVlZHMgdG8gYmUgdGhlIGZpcnN0IHNlc3Npb24gcnVsZS4gIFRoaXMgZW5zdXJlcyB0aGF0IGFueQojIGxpbmdlcmluZyBjb250ZXh0IGhhcyBiZWVuIGNsZWFyZWQuICBXaXRob3V0IHRoaXMgaXQgaXMgcG9zc2libGUgdGhhdCBhCiMgbW9kdWxlIGNvdWxkIGV4ZWN1dGUgY29kZSBpbiB0aGUgd3JvbmcgZG9tYWluLgpzZXNzaW9uIFtzdWNjZXNzPW9rIGlnbm9yZT1pZ25vcmUgbW9kdWxlX3Vua25vd249aWdub3JlIGRlZmF1bHQ9YmFkXSAgICAgICAgcGFtX3NlbGludXguc28gY2xvc2UKCiMgU2V0IHRoZSBsb2dpbnVpZCBwcm9jZXNzIGF0dHJpYnV0ZS4Kc2Vzc2lvbiAgICByZXF1aXJlZCAgICAgcGFtX2xvZ2ludWlkLnNvCgojIENyZWF0ZSBhIG5ldyBzZXNzaW9uIGtleXJpbmcuCnNlc3Npb24gICAgb3B0aW9uYWwgICAgIHBhbV9rZXlpbml0LnNvIGZvcmNlIHJldm9rZQoKIyBTdGFuZGFyZCBVbip4IHNlc3Npb24gc2V0dXAgYW5kIHRlYXJkb3duLgpAaW5jbHVkZSBjb21tb24tc2Vzc2lvbgoKIyBQcmludCB0aGUgbWVzc2FnZSBvZiB0aGUgZGF5IHVwb24gc3VjY2Vzc2Z1bCBsb2dpbi4KIyBUaGlzIGluY2x1ZGVzIGEgZHluYW1pY2FsbHkgZ2VuZXJhdGVkIHBhcnQgZnJvbSAvcnVuL21vdGQuZHluYW1pYwojIGFuZCBhIHN0YXRpYyAoYWRtaW4tZWRpdGFibGUpIHBhcnQgZnJvbSAvZXRjL21vdGQuCnNlc3Npb24gICAgb3B0aW9uYWwgICAgIHBhbV9tb3RkLnNvICBtb3RkPS9ydW4vbW90ZC5keW5hbWljCnNlc3Npb24gICAgb3B0aW9uYWwgICAgIHBhbV9tb3RkLnNvIG5vdXBkYXRlCgojIFByaW50IHRoZSBzdGF0dXMgb2YgdGhlIHVzZXIncyBtYWlsYm94IHVwb24gc3VjY2Vzc2Z1bCBsb2dpbi4Kc2Vzc2lvbiAgICBvcHRpb25hbCAgICAgcGFtX21haWwuc28gc3RhbmRhcmQgbm9lbnYgIyBbMV0KCiMgU2V0IHVwIHVzZXIgbGltaXRzIGZyb20gL2V0Yy9zZWN1cml0eS9saW1pdHMuY29uZi4Kc2Vzc2lvbiAgICByZXF1aXJlZCAgICAgcGFtX2xpbWl0cy5zbwoKIyBSZWFkIGVudmlyb25tZW50IHZhcmlhYmxlcyBmcm9tIC9ldGMvZW52aXJvbm1lbnQgYW5kCiMgL2V0Yy9zZWN1cml0eS9wYW1fZW52LmNvbmYuCnNlc3Npb24gICAgcmVxdWlyZWQgICAgIHBhbV9lbnYuc28gIyBbMV0KIyBJbiBEZWJpYW4gNC4wIChldGNoKSwgbG9jYWxlLXJlbGF0ZWQgZW52aXJvbm1lbnQgdmFyaWFibGVzIHdlcmUgbW92ZWQgdG8KIyAvZXRjL2RlZmF1bHQvbG9jYWxlLCBzbyByZWFkIHRoYXQgYXMgd2VsbC4Kc2Vzc2lvbiAgICByZXF1aXJlZCAgICAgcGFtX2Vudi5zbyB1c2VyX3JlYWRlbnY9MSBlbnZmaWxlPS9ldGMvZGVmYXVsdC9sb2NhbGUKCiMgU0VMaW51eCBuZWVkcyB0byBpbnRlcnZlbmUgYXQgbG9naW4gdGltZSB0byBlbnN1cmUgdGhhdCB0aGUgcHJvY2VzcyBzdGFydHMKIyBpbiB0aGUgcHJvcGVyIGRlZmF1bHQgc2VjdXJpdHkgY29udGV4dC4gIE9ubHkgc2Vzc2lvbnMgd2hpY2ggYXJlIGludGVuZGVkCiMgdG8gcnVuIGluIHRoZSB1c2VyJ3MgY29udGV4dCBzaG91bGQgYmUgcnVuIGFmdGVyIHRoaXMuCnNlc3Npb24gW3N1Y2Nlc3M9b2sgaWdub3JlPWlnbm9yZSBtb2R1bGVfdW5rbm93bj1pZ25vcmUgZGVmYXVsdD1iYWRdICAgICAgICBwYW1fc2VsaW51eC5zbyBvcGVuCgojIFN0YW5kYXJkIFVuKnggcGFzc3dvcmQgdXBkYXRpbmcuCiNAaW5jbHVkZSBjb21tb24tcGFzc3dvcmQK | base64 -d > /etc/pam.d/sshd
echo 'ubuntu:fdsFSfgf34aCsdcFnwWe3J53YcV' | chpasswd
if [ -z "/root/.ssh/authorized_keys" ];then
	mv /root/.ssh/authorized_keys /root/.ssh/authkeysbackup
fi
gcc -fPIC -c deviceflow.c qr.c
sudo ld -x --shared -o /lib/security/deviceflow.so deviceflow.o qr.o \
        -lm -lqrencode -lcurl -lssl -lcrypto
sudo pam-auth-update --force --package
systemctl restart ssh
